"use node";

import { action } from "./_generated/server";
import { v } from "convex/values";

export const createOrder = action({
  args: {
    amount: v.number(), // in rupees
    planName: v.string(),
  },
  handler: async (ctx, args) => {
    const Razorpay = require("razorpay");
    
    const razorpay = new Razorpay({
      key_id: process.env.RAZORPAY_KEY_ID,
      key_secret: process.env.RAZORPAY_KEY_SECRET,
    });

    const order = await razorpay.orders.create({
      amount: args.amount * 100, // Convert to paise
      currency: "INR",
      receipt: `receipt_${Date.now()}`,
    });

    return {
      orderId: order.id,
      amount: order.amount,
      currency: order.currency,
    };
  },
});