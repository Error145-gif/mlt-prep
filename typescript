import { v } from "convex/values";
import { mutation, query } from "./_generated/server";
import { getCurrentUser } from "./users";
import { useQuery, useMutation } from "convex/react";

// Get all active library PDFs
export const getLibraryPDFs = query({
  // ... keep existing code
});

// Check if user has yearly plan access
export const checkLibraryAccess = query({
  // ... keep existing code
});

// Unlock PDF with Ad
export const unlockLibraryPDFWithAd = mutation({
  // ... keep existing code
});

// Admin: Add new PDF
// ... keep existing code

// Get PDFs by subject (for subject sections)
// ... keep existing code
    return pdfsBySubject;
  },

  // Library PDFs (Yearly Plan Exclusive)
  library: defineTable({
    title: v.string(),
    subject: v.string(), // "Hematology", "Biochemistry", etc.
    pdf_url: v.string(), // Cloudflare R2 public URL
    uploadedBy: v.id("users"),
    status: v.string(), // "active", "archived"
  })
    .index("by_subject", ["subject"])
    .index("by_status", ["status"]),

  // Library Ad Unlocks
  libraryAdUnlocks: defineTable({
    userId: v.id("users"),
    pdfId: v.id("library"),
    unlockedAt: v.number(),
  })
    .index("by_user_and_pdf", ["userId", "pdfId"])
    .index("by_user_and_date", ["userId", "unlockedAt"]),

  // Sections
  sections: defineTable({
    // ... keep existing code
  }),

}