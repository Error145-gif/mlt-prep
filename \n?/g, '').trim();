      
      // Parse the JSON response
      let questions;
      try {
        questions = JSON.parse(cleanedText);
      } catch (error) {
        console.error("Error parsing JSON response:", error);
        console.error("Response text:", cleanedText);
        throw new Error("Failed to parse AI-generated questions. Please try again.");
      }

      return questions;